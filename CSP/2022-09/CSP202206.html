<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/Whale-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Whale-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Whale-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="-3vYeYUI32tNnZYynn6m9TEd8b35o91ejIEgj9md_1o">
  <meta name="msvalidate.01" content="52EA62B6D6E7019FD9854082F76A21EA">
  <meta name="baidu-site-verification" content="code-AlOkWF1yk4">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-material.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"meteordream.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":250,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="前言 CSP 2022-06 算法题解析  能力有限仅能做出前 3 题">
<meta property="og:type" content="article">
<meta property="og:title" content="CSP202206">
<meta property="og:url" content="https://meteordream.github.io/CSP/2022-09/CSP202206.html">
<meta property="og:site_name" content="小鲸鱼的梦境">
<meta property="og:description" content="前言 CSP 2022-06 算法题解析  能力有限仅能做出前 3 题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://meteordream.github.io/CSP/2022-09/CCF202206/gxzz.svg">
<meta property="og:image" content="https://meteordream.github.io/CSP/2022-09/CCF202206/Solution2.svg">
<meta property="article:published_time" content="2022-09-09T03:52:46.000Z">
<meta property="article:modified_time" content="2022-09-12T06:50:08.000Z">
<meta property="article:author" content="小鲸鱼">
<meta property="article:tag" content="CSP">
<meta property="article:tag" content="算法">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://meteordream.github.io/CSP/2022-09/CCF202206/gxzz.svg">

<link rel="canonical" href="https://meteordream.github.io/CSP/2022-09/CSP202206.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>CSP202206 | 小鲸鱼的梦境</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">小鲸鱼的梦境</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://meteordream.github.io/CSP/2022-09/CSP202206.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/shizuku.png">
      <meta itemprop="name" content="小鲸鱼">
      <meta itemprop="description" content="小鲸鱼只有七秒钟的记忆">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小鲸鱼的梦境">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CSP202206
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-09 11:52:46" itemprop="dateCreated datePublished" datetime="2022-09-09T11:52:46+08:00">2022-09-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-09-12 14:50:08" itemprop="dateModified" datetime="2022-09-12T14:50:08+08:00">2022-09-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSP/" itemprop="url" rel="index"><span itemprop="name">CSP</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/CSP/2022-09/CSP202206.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/CSP/2022-09/CSP202206.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>22k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>20 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="前言">前言</h2>
<p>CSP 2022-06 算法题解析</p>
<blockquote>
<p>能力有限仅能做出前 3 题</p>
</blockquote>
<span id="more"></span>
<h2 id="归一化处理">归一化处理</h2>
<p>链接：<a target="_blank" rel="noopener" href="http://118.190.20.162/view.page?gpid=T148" class="uri">http://118.190.20.162/view.page?gpid=T148</a></p>
<ul>
<li>时间限制：500ms</li>
<li>空间限制：512.0MB</li>
</ul>
<h3 id="问题描述">问题描述</h3>
<h4 id="题目背景">题目背景</h4>
<p>在机器学习中，对数据进行归一化处理是一种常用的技术。
将数据从各种各样分布调整为平均值为 0、方差为 1
的标准分布，在很多情况下都可以有效地加速模型的训练。</p>
<h4 id="问题描述-1">问题描述</h4>
<p>题目背景在机器学习中，对数据进行归一化处理是一种常用的技术。
将数据从各种各样分布调整为平均值为 0、方差为 1
的标准分布，在很多情况下都可以有效地加速模型的训练。问题描述这里假定需要处理的数据为
<span class="math inline"><em>n</em></span> 个整数 <span class="math inline"><em>a</em><sub>1</sub>, <em>a</em><sub>2</sub>, ⋯, <em>a</em><sub><em>n</em></sub></span>。</p>
<p>这组数据的平均值： <span class="math display">$$
\bar{a} = \frac{a_1 + a_2 + \cdots + a_n}{n}
$$</span> 方差： <span class="math display">$$
D(a) = \frac{1}{n} \sum_{i=1}^{n} \left( a_i - \bar{a} \right)^2
$$</span> 使用如下函数处理所有数据，得到的 <span class="math inline"><em>n</em></span> 个浮点数 <span class="math inline"><em>f</em>(<em>a</em><sub>1</sub>), <em>f</em>(<em>a</em><sub>2</sub>), ⋯, <em>f</em>(<em>a</em><sub><em>n</em></sub>)</span>
即满足平均值为 <span class="math inline">0</span> 且方差为 <span class="math inline">1</span>： <span class="math display">$$
f(a_i) = \frac{a_i - \bar{a} }{\sqrt{D(a)} }
$$</span></p>
<h4 id="输入格式">输入格式</h4>
<p>从标准输入读入数据。</p>
<p>第一行包含一个整数 <span class="math inline"><em>n</em></span>，表示待处理的整数个数。</p>
<p>第二行包含空格分隔的 <span class="math inline"><em>n</em></span>
个整数，依次表示 <span class="math inline"><em>a</em><sub>1</sub>, <em>a</em><sub>2</sub>, ⋯, <em>a</em><sub><em>n</em></sub></span>。</p>
<h4 id="输出格式">输出格式</h4>
<p>输出到标准输出。</p>
<p>输出共 <span class="math inline"><em>n</em></span>
行，每行一个浮点数，依次表示按上述方法归一化处理后的数据 <span class="math inline"><em>f</em>(<em>a</em><sub>1</sub>), <em>f</em>(<em>a</em><sub>2</sub>), ⋯, <em>f</em>(<em>a</em><sub><em>n</em></sub>)</span>。</p>
<h4 id="样例输入">样例输入</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">7</span><br><span class="line">-4 293 0 -22 12 654 1000</span><br></pre></td></tr></table></figure>
<h4 id="样例输出">样例输出</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-0.7485510379073613</span><br><span class="line">0.04504284674812264</span><br><span class="line">-0.7378629047806881</span><br><span class="line">-0.7966476369773906</span><br><span class="line">-0.7057985054006686</span><br><span class="line">1.0096468614303775</span><br><span class="line">1.9341703768876082</span><br></pre></td></tr></table></figure>
<h4 id="样例解释">样例解释</h4>
<p>平均值：<span class="math inline"><em>ā</em> ≈ 276.14285714285717</span></p>
<p>方差：<span class="math inline"><em>D</em>(<em>a</em>) ≈ 140060.69387755104</span></p>
<p>标准差：<span class="math inline">$\sqrt{D(a)} \approx
374.24683549437134$</span></p>
<h4 id="子任务">子任务</h4>
<p>全部的测试数据保证 <span class="math inline"><em>n</em>, |<em>a</em><sub><em>i</em></sub>| ≤ 1000</span>，其中
<span class="math inline">|<em>a</em><sub><em>i</em></sub>|</span> 表示
<span class="math inline"><em>a</em><sub><em>i</em></sub></span>
的绝对值。</p>
<p>且输入的 <span class="math inline"><em>n</em></span> 个整数 <span class="math inline"><em>a</em><sub>1</sub>, <em>a</em><sub>2</sub>, ⋯, <em>a</em><sub><em>n</em></sub></span>
满足：方差 <span class="math inline"><em>D</em>(<em>a</em>) ≥ 1</span>。</p>
<h4 id="评分方式">评分方式</h4>
<p>如果你输出的每个浮点数与参考结果相比，均满足绝对误差不大于 <span class="math inline">10<sup>−4</sup></span>，则该测试点满分，否则不得分。</p>
<h4 id="提示">提示</h4>
<ul>
<li>C/C++：建议使用 double 类型存储浮点数，并使用 printf(“%f”, x);$$’
进行输出。</li>
<li>Python：直接使用 print(x) 进行输出即可。</li>
<li>Java：建议使用 double 类型存储浮点数，可以使用 System.out.print(x);
进行输出。</li>
</ul>
<h3 id="问题解析">问题解析</h3>
<p>极其简单的模拟题</p>
<h4 id="python代码">Python代码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    n = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">    dat = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">float</span>, <span class="built_in">input</span>().split()))</span><br><span class="line">    mean = <span class="built_in">sum</span>(dat) / n</span><br><span class="line">    deviation = (<span class="built_in">sum</span>((a - mean) ** <span class="number">2</span> <span class="keyword">for</span> a <span class="keyword">in</span> dat) / n) ** <span class="number">0.5</span></span><br><span class="line">    dat = <span class="built_in">list</span>((a - mean) / deviation <span class="keyword">for</span> a <span class="keyword">in</span> dat)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, dat)))</span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<p>运行结果</p>
<table>
<colgroup>
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 42%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr>
<th style="text-align: left;">提交编号</th>
<th style="text-align: left;">用户名</th>
<th style="text-align: left;">姓名</th>
<th style="text-align: left;">试题名称</th>
<th style="text-align: left;">提交时间</th>
<th style="text-align: left;">代码长度</th>
<th style="text-align: left;">编程语言</th>
<th style="text-align: left;">评测结果</th>
<th style="text-align: left;">得分</th>
<th style="text-align: left;">时间使用</th>
<th style="text-align: left;">空间使用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;"><a target="_blank" rel="noopener" href="http://118.190.20.162/view.page?gpid=T148">归一化处理</a></td>
<td style="text-align: left;">09-09 12:45</td>
<td style="text-align: left;">257B</td>
<td style="text-align: left;">PYTHON</td>
<td style="text-align: left;">正确</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">31ms</td>
<td style="text-align: left;">8.089MB</td>
</tr>
</tbody>
</table>
<h4 id="c代码">C++代码</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> dat[<span class="number">5555</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;dat[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> mean = <span class="number">.0</span>, dev = <span class="number">.0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) mean += dat[i];</span><br><span class="line">    mean /= n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) dev += <span class="built_in">pow</span>(dat[i] - mean, <span class="number">2</span>);</span><br><span class="line">    dev = <span class="built_in">pow</span>(dev / n, <span class="number">0.5</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%f\n&quot;</span>, (dat[i] - mean) / dev);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果</p>
<table>
<colgroup>
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 42%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr>
<th style="text-align: left;">提交编号</th>
<th style="text-align: left;">用户名</th>
<th style="text-align: left;">姓名</th>
<th style="text-align: left;">试题名称</th>
<th style="text-align: left;">提交时间</th>
<th style="text-align: left;">代码长度</th>
<th style="text-align: left;">编程语言</th>
<th style="text-align: left;">评测结果</th>
<th style="text-align: left;">得分</th>
<th style="text-align: left;">时间使用</th>
<th style="text-align: left;">空间使用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;"><a target="_blank" rel="noopener" href="http://118.190.20.162/view.page?gpid=T148">归一化处理</a></td>
<td style="text-align: left;">09-09 13:08</td>
<td style="text-align: left;">466B</td>
<td style="text-align: left;">CPP14</td>
<td style="text-align: left;">正确</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">0ms</td>
<td style="text-align: left;">2.957MB</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="寻宝大冒险">寻宝！大冒险！</h2>
<p>链接：<a target="_blank" rel="noopener" href="http://118.190.20.162/view.page?gpid=T147" class="uri">http://118.190.20.162/view.page?gpid=T147</a></p>
<ul>
<li>时间限制：500ms</li>
<li>空间限制：512.0MB</li>
</ul>
<h3 id="问题描述-2">问题描述</h3>
<h4 id="题目背景-1">题目背景</h4>
<p>暑假要到了。可惜由于种种原因，小 P 原本的出游计划取消。失望的小 P
只能留在西西艾弗岛上度过一个略显单调的假期……直到……</p>
<p>某天，小 P 获得了一张神秘的藏宝图。</p>
<h4 id="问题描述-3">问题描述</h4>
<p>西西艾弗岛上种有 <span class="math inline"><em>n</em></span>
棵树，这些树的具体位置记录在一张绿化图上。
简单地说，西西艾弗岛绿化图可以视作一个大小为 <span class="math inline">(<em>L</em> + 1) × (<em>L</em> + 1)</span> 的 <span class="math inline">01</span> 矩阵 <span class="math inline"><em>A</em></span>， 地图左下角（坐标 <span class="math inline">(0, 0)</span>）和右上角（坐标 <span class="math inline">(<em>L</em>, <em>L</em>)</span>）分别对应 <span class="math inline"><em>A</em>[0][0]</span> 和 <span class="math inline"><em>A</em>[<em>L</em>][<em>L</em>]</span>。 其中
<span class="math inline"><em>A</em>[<em>i</em>][<em>j</em>] = 1</span>
表示坐标 <span class="math inline">(<em>i</em>, <em>j</em>)</span>
处种有一棵树，<span class="math inline"><em>A</em>[<em>i</em>][<em>j</em>] = 0</span>
则表示坐标 <span class="math inline">(<em>i</em>, <em>j</em>)</span>
处没有树。 换言之，矩阵 <span class="math inline"><em>A</em></span>
中有且仅有的 <span class="math inline"><em>n</em></span> 个 <span class="math inline">1</span> 展示了西西艾弗岛上 <span class="math inline"><em>n</em></span> 棵树的具体位置。</p>
<p>传说，大冒险家顿顿的宝藏就埋藏在某棵树下。
并且，顿顿还从西西艾弗岛的绿化图上剪下了一小块，制作成藏宝图指示其位置。
具体来说，藏宝图可以看作一个大小为 <span class="math inline">(<em>S</em> + 1) × (<em>S</em> + 1)</span> 的 <span class="math inline">01</span> 矩阵 <span class="math inline"><em>B</em></span>（<span class="math inline"><em>S</em></span> 远小于 <span class="math inline"><em>L</em></span>），对应着 <span class="math inline"><em>A</em></span> 中的某一部分。 理论上，绿化图
<span class="math inline"><em>A</em></span> 中存在着一处坐标 <span class="math inline">(<em>x</em>, <em>y</em>)(0 ≤ <em>x</em>, <em>y</em> ≤ <em>L</em> − <em>S</em>)</span>
与藏宝图 <span class="math inline"><em>B</em></span> 左下角 <span class="math inline">(0, 0)</span> 相对应，即满足： 对 <span class="math inline"><em>B</em></span> 上任意一处坐标 <span class="math inline">(<em>i</em>, <em>j</em>)</span>（<span class="math inline">0 ≤ <em>i</em>, <em>j</em> ≤ <em>S</em></span>），都有
<span class="math inline"><em>A</em>[<em>x</em> + <em>i</em>][<em>y</em> + <em>j</em>] = <em>B</em>[<em>i</em>][<em>j</em>]</span>。
当上述条件满足时，我们就认为藏宝图 <span class="math inline"><em>B</em></span> 对应着绿化图 <span class="math inline"><em>A</em></span> 中左下角为 <span class="math inline">(<em>x</em>, <em>y</em>)</span>、右上角为 <span class="math inline">(<em>x</em> + <em>S</em>, <em>y</em> + <em>S</em>)</span>
的区域。</p>
<p>实际上，考虑到藏宝图仅描绘了很小的一个范围，满足上述条件的坐标 <span class="math inline">(<em>x</em>, <em>y</em>)</span> 很可能存在多个。
请结合西西艾弗岛绿化图中 <span class="math inline"><em>n</em></span>
棵树的位置，以及小 <span class="math inline"><em>P</em></span>
手中的藏宝图，判断绿化图中有多少处坐标满足条件。</p>
<p>特别地，藏宝图左下角位置一定是一棵树，即 <span class="math inline"><em>A</em>[<em>x</em>][<em>y</em>] = <em>B</em>[0][0] = 1</span>，表示了宝藏埋藏的位置。</p>
<h4 id="输入格式-1">输入格式</h4>
<p>从标准输入读入数据。</p>
<p>输入的第一行包含空格分隔的三个正整数 <span class="math inline"><em>n</em></span>、<span class="math inline"><em>L</em></span> 和 <span class="math inline"><em>S</em></span>，分别表示西西艾弗岛上树的棵数、绿化图和藏宝图的大小。</p>
<p>由于绿化图尺寸过大，输入数据中仅包含 <span class="math inline"><em>n</em></span> 棵树的坐标而非完整的地图；即接下来
<span class="math inline"><em>n</em></span> 行每行包含空格分隔的两个整数
<span class="math inline"><em>x</em></span> 和 <span class="math inline"><em>y</em></span>，表示一棵树的坐标，满足 <span class="math inline">0 ≤ <em>x</em>, <em>y</em> ≤ <em>L</em></span>
且同一坐标不会重复出现。</p>
<p>最后 <span class="math inline">(<em>S</em> + 1)</span> 行输入小 P
手中完整的藏宝图，其中第 <span class="math inline"><em>i</em></span>
行（<span class="math inline">0 ≤ <em>i</em> ≤ <em>S</em></span>）包含空格分隔的
<span class="math inline">(<em>S</em> + 1)</span> 个 <span class="math inline">0</span> 和 <span class="math inline">1</span>，表示
<span class="math inline"><em>B</em>[<em>S</em> − <em>i</em>][0]⋯<em>B</em>[<em>S</em> − <em>i</em>][<em>S</em>]</span>。
<strong>需要注意</strong>，最先输入的是 <span class="math inline"><em>B</em>[<em>S</em>][0]⋯<em>B</em>[<em>S</em>][<em>S</em>]</span>
一行，<span class="math inline"><em>B</em>[0][0]⋯<em>B</em>[0][<em>S</em>]</span>
一行最后输入</p>
<h4 id="输出格式-1">输出格式</h4>
<p>输出到标准输出。</p>
<p>输出一个整数，表示绿化图中有多少处坐标可以与藏宝图左下角对应，即可能埋藏着顿顿的宝藏。</p>
<h4 id="样例1输入">样例1输入</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">5 100 2</span><br><span class="line">0 0</span><br><span class="line">1 1</span><br><span class="line">2 2</span><br><span class="line">3 3</span><br><span class="line">4 4</span><br><span class="line">0 0 1</span><br><span class="line">0 1 0</span><br><span class="line">1 0 0</span><br></pre></td></tr></table></figure>
<h4 id="样例1输出">样例1输出</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure>
<h4 id="样例1解释">样例1解释</h4>
<p>绿化图上 <span class="math inline">(0, 0)</span>、<span class="math inline">(1, 1)</span> 和 <span class="math inline">(2, 2)</span> 三处均可能埋有宝藏。</p>
<h4 id="样例2输入">样例2输入</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">5 4 2</span><br><span class="line">0 0</span><br><span class="line">1 1</span><br><span class="line">2 2</span><br><span class="line">3 3</span><br><span class="line">4 4</span><br><span class="line">0 0 0</span><br><span class="line">0 1 0</span><br><span class="line">1 0 0</span><br></pre></td></tr></table></figure>
<h4 id="样例2输出">样例2输出</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0</span><br></pre></td></tr></table></figure>
<h4 id="样例2解释">样例2解释</h4>
<p>如果将藏宝图左下角与绿化图 <span class="math inline">(3, 3)</span>
处对应，则藏宝图右上角会超出绿化图边界，对应不成功。</p>
<h4 id="子任务-1">子任务</h4>
<p><span class="math inline">40%</span> 的测试数据满足：<span class="math inline"><em>L</em> ≤ 50</span>；</p>
<p><span class="math inline">70%</span> 的测试数据满足：<span class="math inline"><em>L</em> ≤ 2000</span>；</p>
<p>全部的测试数据满足：<span class="math inline"><em>n</em> ≤ 1000</span>、<span class="math inline"><em>L</em> ≤ 10<sup>9</sup></span> 且 <span class="math inline"><em>S</em> ≤ 50</span>。</p>
<h4 id="提示-1">提示</h4>
<p>实际测试数据中不包括答案为 <span class="math inline">0</span>
的用例。</p>
<h3 id="问题解析-1">问题解析</h3>
<p>关键在于如何进行<strong>藏宝图</strong>和<strong>地图</strong>之间的快速匹配</p>
<ul>
<li>因为地图太大了，所以对每个点逐一匹配肯定不用考虑，但对于 <span class="math inline">70%</span> 的子任务这种简单方法是可以的</li>
<li>进一步考虑将藏宝图进行哈希，并用与藏宝图等大的块在地图中进行滚动哈希匹配，但地图太大了，这个想法同样只能通过
<span class="math inline">70%</span>
的子任务而且设计哈希函数比前面的麻烦得多</li>
<li>注意到地图中最多有 1000 颗树且藏宝图 <span class="math inline"><em>S</em></span> 仅仅才
50，且藏宝图左下角肯定有一颗树，所以我们可以以这颗树为锚点进行匹配，最多进行
<span class="math inline">1000</span> 次匹配，每次匹配代价为 <span class="math inline"><em>S</em><sup>2</sup></span>
次，这个代价是可以接受的，这个想法的最大问题是如何保存地图使得快速确定地图中某个位置是否有树，显然，哈希表是很好的选择</li>
</ul>
<blockquote>
<p>PS:
地图是我们惯用的左下角为原点的坐标系，但矩阵的坐标系是与惯用坐标系上下对称的，为了方便不混淆，代码中的坐标系按照矩阵坐标系进行运算，这并不影响结果</p>
</blockquote>
<h4 id="运行结果">运行结果</h4>
<table style="width:100%;">
<colgroup>
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 44%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr>
<th style="text-align: left;">提交编号</th>
<th style="text-align: left;">用户名</th>
<th style="text-align: left;">姓名</th>
<th style="text-align: left;">试题名称</th>
<th style="text-align: left;">提交时间</th>
<th style="text-align: left;">代码长度</th>
<th style="text-align: left;">编程语言</th>
<th style="text-align: left;">评测结果</th>
<th style="text-align: left;">得分</th>
<th style="text-align: left;">时间使用</th>
<th style="text-align: left;">空间使用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;"><a target="_blank" rel="noopener" href="http://118.190.20.162/view.page?gpid=T147">寻宝！大冒险！</a></td>
<td style="text-align: left;">09-09 20:34</td>
<td style="text-align: left;">1.275KB</td>
<td style="text-align: left;">CPP14</td>
<td style="text-align: left;">正确</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">15ms</td>
<td style="text-align: left;">2.886MB</td>
</tr>
<tr>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;"><a target="_blank" rel="noopener" href="http://118.190.20.162/view.page?gpid=T147">寻宝！大冒险！</a></td>
<td style="text-align: left;">09-09 16:52</td>
<td style="text-align: left;">960B</td>
<td style="text-align: left;">PYTHON</td>
<td style="text-align: left;">正确</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">125ms</td>
<td style="text-align: left;">8.074MB</td>
</tr>
</tbody>
</table>
<h4 id="python代码-1">Python代码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">MOD = <span class="built_in">int</span>(<span class="number">2e9</span>) + <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loc2num</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> x * MOD + y</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">match</span>(<span class="params">A, B, x, y, L</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;在 (x, y) 进行地图匹配</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        A (set): 存储树的坐标的集合</span></span><br><span class="line"><span class="string">        B (List): 藏宝图</span></span><br><span class="line"><span class="string">        x (int): 坐标</span></span><br><span class="line"><span class="string">        y (int): 坐标</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i, row <span class="keyword">in</span> <span class="built_in">enumerate</span>(B):</span><br><span class="line">        <span class="keyword">for</span> j, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(row):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">0</span> &lt;= x + i &lt;= L <span class="keyword">and</span> <span class="number">0</span> &lt;= y + j &lt;= L:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            true_loc = loc2num(x + i, y + j)</span><br><span class="line">            <span class="keyword">if</span> c == <span class="number">1</span> <span class="keyword">and</span> true_loc <span class="keyword">in</span> A:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> c == <span class="number">0</span> <span class="keyword">and</span> true_loc <span class="keyword">not</span> <span class="keyword">in</span> A:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    n, L, S = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split())</span><br><span class="line">    A = [<span class="built_in">tuple</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split())) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    B = [<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split())) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(S + <span class="number">1</span>)]</span><br><span class="line">    B.reverse()</span><br><span class="line">    tree = &#123;loc2num(x, y) <span class="keyword">for</span> x, y <span class="keyword">in</span> A&#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">sum</span>(<span class="keyword">match</span>(tree, B, x, y, L) <span class="keyword">for</span> x, y <span class="keyword">in</span> A))</span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<h4 id="c代码-1">C++代码</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line">ll MOD = <span class="number">2000000007</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, L, S;</span><br><span class="line"><span class="type">int</span> A[<span class="number">1007</span>][<span class="number">2</span>], B[<span class="number">55</span>][<span class="number">55</span>];</span><br><span class="line">unordered_set&lt;ll&gt; tree;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_A</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;A[i][<span class="number">0</span>], &amp;A[i][<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_B</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= S; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= S; ++j) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;B[S - i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">loc2num</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    ll ans = x;</span><br><span class="line">    <span class="keyword">return</span> ans * MOD + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">match</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= S; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= S; ++j) &#123;</span><br><span class="line">            <span class="type">int</span> a = x + i, b = y + j;</span><br><span class="line">            <span class="keyword">if</span> (a &lt; <span class="number">0</span> || a &gt; L || b &lt; <span class="number">0</span> || b &gt; L) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            ll key = <span class="built_in">loc2num</span>(a, b);</span><br><span class="line">            <span class="keyword">if</span> (B[i][j] == <span class="number">0</span> &amp;&amp; tree.<span class="built_in">find</span>(key) == tree.<span class="built_in">end</span>())</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (B[i][j] == <span class="number">1</span> &amp;&amp; tree.<span class="built_in">find</span>(key) != tree.<span class="built_in">end</span>())</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;n, &amp;L, &amp;S);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">get_A</span>();</span><br><span class="line">    <span class="built_in">get_B</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        tree.<span class="built_in">emplace</span>(<span class="built_in">loc2num</span>(A[i][<span class="number">0</span>], A[i][<span class="number">1</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">match</span>(A[i][<span class="number">0</span>], A[i][<span class="number">1</span>])) ++cnt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, cnt);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="角色授权">角色授权</h2>
<p>链接：<a target="_blank" rel="noopener" href="http://118.190.20.162/view.page?gpid=T146" class="uri">http://118.190.20.162/view.page?gpid=T146</a></p>
<ul>
<li>时间限制：5.0s</li>
<li>空间限制：512.0MB</li>
</ul>
<h3 id="问题描述-4">问题描述</h3>
<h4 id="题目背景-2">题目背景</h4>
<p>为了响应国家发展新基建的倡议，西西艾弗岛上兴建了西西艾弗数据中心，并以此为基础运营了西西艾弗云。作为数据中心的运营和维护方，
西西艾弗云公司十分重视西西艾弗云的网络安全管理工作。众所周知，安全性和便捷性难以兼得，同时，
一个混乱的权限模型可能会导致人员被授予不必要的权限，从而造成安全风险。因此在西西艾弗云公司的网络安全部工作的小
C 专门设计了一种科学的权限模型。</p>
<p>这种安全模型将验证流程分为两个步骤。第一步是验证用户的身份（鉴别），第二步是验证用户的权限（授权）。在第一步，
首先验证一个用户是否是该用户所声称的那个身份。例如，通过验证用户提供的口令（Password）是否正确，或者通过验证用户提供的智能卡是否合法有效。
接下来，在授权的步骤中，权限策略会被检索以便判断来访的用户是否能够操作系统中的某个资源。</p>
<p>为了能够灵活地表达用户和授权之间的关系，西西艾弗云公司设计了一种简洁而灵活的授权模型：基于角色的授权模型。它的思路是：首先设定若干角色，
每个角色中指明了一个清单，表明允许访问的资源的种类、资源的名称和对资源的操作；然后将被前一步骤已经鉴别过的用户和一个或多个角色相关联。
某个用户能够执行的操作，即为与其关联的全部角色中允许的操作的并集。</p>
<p>小 C 将实现授权模型的工作交给了你，希望你能够把它们实现出来。</p>
<h4 id="问题描述-5">问题描述</h4>
<p><strong>用户</strong>表示授权模型中的一个已识别的主体，该识别过程由此前的鉴别过程完成。一个用户具有下列要素：</p>
<ul>
<li>名称：是一个字符串，用于唯一标识一个用户；</li>
<li>用户组：是一个数组，包含若干个字符串，表示该用户所属的用户组。</li>
</ul>
<p>一个待授权的行为，包括下列要素：</p>
<ul>
<li>主体：是一个用户，包括试图进行该行为的用户的名称和该用户所属的用户组；</li>
<li>操作：是一个字符串，一般是一个动词，例如
<code>Read</code>、<code>Open</code>、<code>Close</code> 等；</li>
<li>资源：表示该行为的操作对象，由资源种类和资源名称描述。资源种类例如
<code>Door</code>、<code>File</code>
等；在一个特定的资源种类中，资源名称唯一确定了一个资源。</li>
</ul>
<p>需要注意的是，一个待授权的行为的主体信息，即用户名称和所属用户组，是由前一步骤的鉴别过程完成的。因此，每次授权过程中，
每个待授权的行为都会包含主体用户和其关联的用户组的信息。由于鉴权过程中的其它因素，同一个名称的用户在先后两次待授权的行为中所属的用户组可能有区别，
不能存储或记忆此前每个待授权的行为中，用户与用户组的关联情况，而是要按照每次待授权的行为中给出的信息独立判断。</p>
<p><strong>角色</strong>是这种授权模型的基本单位，它指明了一个用户可以执行的操作，角色的清单中描述了角色所允许的操作。一个角色包含下列要素：</p>
<ul>
<li>名称，是一个字符串，用于唯一标识一个角色；</li>
<li>操作清单，是一个数组，包含一个或多个操作，表示该角色允许执行的操作集合；</li>
<li>资源种类清单，是一个数组，包含一个或多个资源种类，表示该角色允许操作的资源的种类集合；</li>
<li>资源名称清单，是一个数组，包含若干个资源名称，表示该角色允许操作的资源的名称集合。</li>
</ul>
<p>判断一个角色能否对某个资源执行某个操作的过程是：</p>
<ol type="1">
<li>检查该角色的操作清单，如果该角色的操作清单中不包含该操作，且该角色的操作清单中也不包含字符串
<code>*</code>，那么不能执行该操作；</li>
<li>检查该角色的资源种类清单，如果该角色的资源种类清单中不包含该资源的种类，且该角色的资源种类清单中也不包含字符串
<code>*</code>，那么不能执行该操作；</li>
<li>检查该角色的资源名称清单，如果该角色的资源名称清单中不包含该资源的名称，且该角色的资源名称清单不是空数组，那么不能执行该操作；</li>
<li>允许执行该操作。</li>
</ol>
<p>例如，假设有某个角色 <code>Doorman</code>，其允许执行的操作有
<code>Open</code> 和 <code>Close</code>，其允许操作的资源类型有
<code>Door</code>，其允许操作的资源名称有 <code>FrontDoor</code> 和
<code>BackDoor</code>。 如果某用户与这个角色关联，那么该用户可以对名为
<code>FrontDoor</code> 的 <code>Door</code> 执行 <code>Open</code>
操作，但是不能对 <code>BackDoor</code> 的 <code>Door</code> 执行
<code>Delete</code> 操作。
同时，一个角色能允许进行的操作可以用通配符来表示。例如，另有一个角色
<code>Admin</code>，其允许执行的操作有
<code>*</code>，允许操作的资源类型是
<code>*</code>，其允许操作的资源名称列表为空，
那么与该角色关联的所有用户可以执行任何操作。值得注意的是，一个角色的操作清单，只能用允许列表的方式列举该角色允许进行的操作，而不能禁止角色进行某个操作。</p>
<p><strong>角色关联</strong>指明了一个用户和一个或多个角色之间的关系。一个角色关联包含下列要素：</p>
<ul>
<li>角色名称，是一个字符串，用于指明一个角色；</li>
<li>授权对象清单，是一个数组，包含一个或多个用户名称或者用户组名称，表示该角色关联的用户和用户组的集合。</li>
</ul>
<p>判断一个用户能否执行某个操作的过程是：</p>
<ol type="1">
<li>检查所有的角色关联的授权对象清单，如果清单中包含该用户的名称，或者该清单中包含该用户所属的某一个用户组的名称，那么选取该角色关联所关联的角色；</li>
<li>对于所有被选取的角色，判断这些角色是否能对该资源执行该操作，如果所有角色都不能执行该操作，那么不能执行该操作；</li>
<li>允许执行该操作。</li>
</ol>
<p>由此可见，一个角色关联可以将一个角色与多个用户或用户组关联起来。例如，如果有一个角色关联，其关联的角色名称为
<code>Doorman</code>，其关联的用户和用户组清单为 用户
<code>foo1</code>、用户 <code>foo2</code>、用户组
<code>bar</code>。那么这些用户会与 <code>Doorman</code> 角色关联：</p>
<ul>
<li>名为 <code>foo1</code> 的用户，属于用户组 <code>bar</code>；</li>
<li>名为 <code>foo2</code> 的用户，属于用户组 <code>barz</code>；</li>
<li>名为 <code>foo3</code> 的用户，属于用户组 <code>bar</code> 和
<code>barz</code>。</li>
</ul>
<p>但是，属于用户组 <code>barz</code> 的名为 <code>foo4</code>
的用户不能与 <code>Doorman</code> 的角色关联。</p>
<p>从上述判断规则可以知道，一个用户可能与多个角色相关联，在这种情况下，该用户允许进行的操作是这些角色被允许进行的操作集合的<strong>并集</strong>。</p>
<h4 id="输入格式-2">输入格式</h4>
<p>从标准输入读入数据。</p>
<p>输入的第一行包含三个正整数 <span class="math inline"><em>n</em></span>、<span class="math inline"><em>m</em></span>、<span class="math inline"><em>q</em></span>，分别表示角色数量、角色关联数量和待检查的操作数量。</p>
<p>输入接下来的 <span class="math inline"><em>n</em></span>
行中，每行表示一个角色，包括空格分隔的若干元素，依次为：</p>
<ul>
<li>一个字符串，表示该角色的名称；</li>
<li>一个正整数 <span class="math inline"><em>n</em><em>v</em></span>，表示操作清单中包含的操作数量；</li>
<li><span class="math inline"><em>n</em><em>v</em></span>
个字符串，依次表示操作清单中的操作；</li>
<li>一个正整数 <span class="math inline"><em>n</em><em>o</em></span>，表示资源种类清单中包含的资源种类的数量；</li>
<li><span class="math inline"><em>n</em><em>o</em></span>
个字符串，依次表示资源种类清单中的资源种类；</li>
<li>一个非负整数 <span class="math inline"><em>n</em><em>n</em></span>，表示资源名称清单中包含的资源名称的数量；</li>
<li><span class="math inline"><em>n</em><em>n</em></span>
个字符串，依次表示资源名称清单中的资源名称。</li>
</ul>
<p>输入接下来的 <span class="math inline"><em>m</em></span>
行中，每行表示一个角色关联，包括空格分隔的若干元素，依次为：</p>
<ul>
<li>一个字符串，表示该角色关联的角色名称；</li>
<li>一个正整数 <span class="math inline"><em>n</em><em>s</em></span>，表示授权对象清单中包含的授权对象的数量；</li>
<li><span class="math inline">2<em>n</em><em>s</em></span>
个字符串，每两个表示授权对象清单中的授权对象，前一个字符串为
<code>u</code> 或
<code>g</code>，分别表示这个授权对象是一个用户名称或者用户组名称，后一个字符串为用户名称或者用户组名称。</li>
</ul>
<p>输入接下来的 <span class="math inline"><em>q</em></span>
行中，每行表示一个待授权的行为，包括空格分隔的若干元素，依次为：</p>
<ul>
<li>一个字符串，表示执行该操作的用户名称；</li>
<li>一个正整数 <span class="math inline"><em>n</em><em>g</em></span>，表示该用户所属的用户组的数量；</li>
<li><span class="math inline"><em>n</em><em>g</em></span>
个字符串，依次表示该用户所属的用户组的名称；</li>
<li>一个字符串，表示待查操作的名称；</li>
<li>一个字符串，表示被操作的资源种类；</li>
<li>一个字符串，表示被操作的资源名称。</li>
</ul>
<h4 id="输出格式-2">输出格式</h4>
<p>输出到标准输出。</p>
<p>输出 <span class="math inline"><em>q</em></span>
行，每行表示一个操作是否可以被执行，<code>0</code>
表示不能执行，<code>1</code> 表示可以执行。</p>
<h4 id="样例输入-1">样例输入</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 2 3</span><br><span class="line">op 1 open 1 door 0</span><br><span class="line">op 1 g sre</span><br><span class="line">op 1 u xiaop</span><br><span class="line">xiaoc 2 sre ops open door room302</span><br><span class="line">xiaop 1 ops open door room501</span><br><span class="line">xiaoc 2 sre ops remove door room302</span><br></pre></td></tr></table></figure>
<h4 id="样例输出-1">样例输出</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">1</span><br><span class="line">0</span><br></pre></td></tr></table></figure>
<h4 id="样例解释-1">样例解释</h4>
<p>在本例中，定义了一个名为 <code>op</code> 的角色，授予了对任意
<code>door</code> 类型的对象的 <code>open</code>
操作的权限，同时定义了两个指向 <code>op</code> 的角色关联。
注意，可以针对一个角色定义多于一个角色关联。本例给出了三个待授权的行为。其中，第一个行为，授权的主体用户是
<code>xiaoc</code>， 该用户所属的用户组 <code>sre</code> 被关联
<code>op</code>
角色，因此可以执行开门动作。第二个行为中，授权的主体用户是
<code>xiaop</code>， 该用户被直接关联了 <code>op</code>
角色，因此也可以执行开门动作。第三个行为中，授权的主体用户仍是
<code>xiaoc</code>，关联的角色仍为 <code>op</code>。但是， 由于
<code>op</code> 角色并未被授予 <code>remove</code>
操作的权限，因此该动作被拒绝。</p>
<h4 id="子任务-2">子任务</h4>
<p>对于 20% 的数据，有 <span class="math inline"><em>n</em> = <em>m</em> = 1</span>，且给出的角色类似于题目正文中用于举例的
<code>Admin</code>，允许执行任何操作，且 <span class="math inline"><em>n</em><em>v</em> = <em>n</em><em>o</em> = <em>n</em><em>s</em> = <em>n</em><em>g</em> = 1</span>、<span class="math inline"><em>n</em><em>n</em> = 0</span>。</p>
<p>对于 40% 的数据，有 <span class="math inline">1 ≤ <em>n</em>, <em>m</em> ≤ 50</span>，且 <span class="math inline"><em>n</em><em>v</em> = <em>n</em><em>o</em> = <em>n</em><em>s</em> = 1</span>、<span class="math inline"><em>n</em><em>g</em> ≤ 40</span>、<span class="math inline"><em>n</em><em>n</em> = 0</span>。</p>
<p>对于 70% 的数据，有 <span class="math inline">1 ≤ <em>n</em>, <em>m</em> ≤ 50</span>，且 <span class="math inline"><em>n</em><em>v</em>, <em>n</em><em>o</em>, <em>n</em><em>s</em>, <em>n</em><em>g</em> ≤ 40</span>。</p>
<p>对于 100% 的数据，有：</p>
<ul>
<li><span class="math inline">1 ≤ <em>n</em>, <em>m</em> ≤ 500</span>；</li>
<li><span class="math inline">1 ≤ <em>q</em> ≤ 5000</span>；</li>
<li><span class="math inline">1 ≤ <em>n</em><em>v</em>, <em>n</em><em>o</em>, <em>n</em><em>s</em>, <em>n</em><em>g</em> ≤ 400</span>；</li>
<li><span class="math inline">0 ≤ <em>n</em><em>n</em> ≤ 400</span>；</li>
<li>全部字符串或为
<code>*</code>，或仅包含大写字母、小写字母、数字（<code>A-Za-z0-9</code>），且字符数目不超过
10。</li>
</ul>
<h3 id="问题解析-2">问题解析</h3>
<p>大模拟题，难度在读题和理解题意，首先理顺思路</p>
<p>从<strong>背景</strong>和<strong>输出格式</strong>中，我们了解到，算法要实现的功能是判断给出的操作能否执行，在题目背景中，我们了解到其大致流程</p>
<ol type="1">
<li>用户不直接与操作是否可以执行相关联，而是使用了角色作为中转</li>
<li>所谓角色，我觉得可以认为是代理，用户执行操作需要委托代理进行操作，而每一种代理能执行哪些操作是已经固定的</li>
</ol>
<p>而在描述中，我们了解到</p>
<ul>
<li>已知条件：角色、角色关联、操作</li>
<li>目标：判断给出的 操作 是否可以执行</li>
</ul>
<p>而具体对象有：</p>
<ul>
<li>用户：名称、用户组</li>
<li>行为：主体（用户）、操作、资源</li>
<li>角色：名称、操作清单、资源种类清单、资源名称清单</li>
<li>关联：角色名称、授权对象清单</li>
</ul>
<p>如何判断判断一个用户能否执行某个操作呢？</p>
<ol type="1">
<li>检查所有的角色关联的授权对象清单，如果清单中包含该用户的名称，或者该清单中包含该用户所属的某一个用户组的名称，那么选取该角色关联所关联的角色；</li>
<li>对于所有被选取的角色，判断这些角色是否能对该资源执行该操作
<ol type="1">
<li>检查该角色的操作清单，如果该角色的操作清单中不包含该操作，且该角色的操作清单中也不包含字符串
<code>*</code>，那么不能执行该操作；</li>
<li>检查该角色的资源种类清单，如果该角色的资源种类清单中不包含该资源的种类，且该角色的资源种类清单中也不包含字符串
<code>*</code>，那么不能执行该操作；</li>
<li>检查该角色的资源名称清单，如果该角色的资源名称清单中不包含该资源的名称，且该角色的资源名称清单不是空数组，那么不能执行该操作；</li>
</ol></li>
<li>如果所有角色都不能执行该操作，那么不能执行该操作；</li>
<li>允许执行该操作。</li>
</ol>
<p><strong>总的来说</strong>，我们实现的内容其实也很简单，根据用户查找角色（代理），判断代理能否执行操作即可，关键是用户与角色之间的关系是通过关联来建模的，其中还有动态的用户组在其中。</p>
<p>因为我们的要求是根据用户查找角色，所以必须建立 用户 <span class="math inline">→</span> 角色 以及 用户组 <span class="math inline">→</span> 角色
的映射，随后遍历所有关联的角色判断是否可以执行操作。</p>
<h4 id="运行结果-1">运行结果</h4>
<table>
<colgroup>
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 42%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr>
<th style="text-align: left;">提交编号</th>
<th style="text-align: left;">用户名</th>
<th style="text-align: left;">姓名</th>
<th style="text-align: left;">试题名称</th>
<th style="text-align: left;">提交时间</th>
<th style="text-align: left;">代码长度</th>
<th style="text-align: left;">编程语言</th>
<th style="text-align: left;">评测结果</th>
<th style="text-align: left;">得分</th>
<th style="text-align: left;">时间使用</th>
<th style="text-align: left;">空间使用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;"><a target="_blank" rel="noopener" href="http://118.190.20.162/view.page?gpid=T146">角色授权</a></td>
<td style="text-align: left;">09-10 15:44</td>
<td style="text-align: left;">3.250KB</td>
<td style="text-align: left;">PYTHON</td>
<td style="text-align: left;">正确</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">4.296s</td>
<td style="text-align: left;">126.7MB</td>
</tr>
</tbody>
</table>
<h4 id="python代码-2">Python代码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">role</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 角色, 包含 name, op, source_type, source_name 四个属性，name 是字符串其他三个都是集合 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, info: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 解析 角色 的输入 &quot;&quot;&quot;</span></span><br><span class="line">        info = <span class="built_in">iter</span>(info.split())</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.name = <span class="built_in">next</span>(info)</span><br><span class="line">        nv = <span class="built_in">int</span>(<span class="built_in">next</span>(info))</span><br><span class="line">        <span class="variable language_">self</span>.op = <span class="built_in">set</span>(<span class="built_in">next</span>(info) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(nv))</span><br><span class="line">        no = <span class="built_in">int</span>(<span class="built_in">next</span>(info))</span><br><span class="line">        <span class="variable language_">self</span>.source_type = <span class="built_in">set</span>(<span class="built_in">next</span>(info) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(no))</span><br><span class="line">        nn = <span class="built_in">int</span>(<span class="built_in">next</span>(info))</span><br><span class="line">        <span class="variable language_">self</span>.source_name = <span class="built_in">set</span>(<span class="built_in">next</span>(info) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(nn))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_role_link</span>(<span class="params">info: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 解析 角色关联 的输入 &quot;&quot;&quot;</span></span><br><span class="line">    info = <span class="built_in">iter</span>(info.split())</span><br><span class="line">    name = <span class="built_in">next</span>(info)</span><br><span class="line">    ns = <span class="built_in">int</span>(<span class="built_in">next</span>(info))</span><br><span class="line">    group = [(<span class="built_in">next</span>(info), <span class="built_in">next</span>(info)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(ns)]</span><br><span class="line">    <span class="keyword">return</span> name, group</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_act</span>(<span class="params">info: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 解析 待授权的行为 的输入 &quot;&quot;&quot;</span></span><br><span class="line">    info = <span class="built_in">iter</span>(info.split())</span><br><span class="line">    user_name = <span class="built_in">next</span>(info)</span><br><span class="line">    ng = <span class="built_in">int</span>(<span class="built_in">next</span>(info))</span><br><span class="line">    group = [<span class="built_in">next</span>(info) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(ng)]</span><br><span class="line">    op_name = <span class="built_in">next</span>(info)</span><br><span class="line">    source_type = <span class="built_in">next</span>(info)</span><br><span class="line">    source_name = <span class="built_in">next</span>(info)</span><br><span class="line">    <span class="keyword">return</span> user_name, group, op_name, source_type, source_name</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_role_list</span>(<span class="params">roles: <span class="built_in">dict</span>, users: <span class="built_in">dict</span>, user_name: <span class="built_in">str</span>, group: <span class="built_in">list</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 获取用户及用户组对应的角色 &quot;&quot;&quot;</span></span><br><span class="line">    r = users[<span class="string">&quot;u_&quot;</span> + user_name]</span><br><span class="line">    <span class="keyword">for</span> g <span class="keyword">in</span> group:</span><br><span class="line">        r = r | users[<span class="string">&quot;g_&quot;</span> + g]</span><br><span class="line">    <span class="keyword">for</span> rr <span class="keyword">in</span> r:</span><br><span class="line">        <span class="keyword">yield</span> roles[rr]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_op</span>(<span class="params">r: role, op, source_type, source_name</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 判断角色能否执行某个操作 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. 检查该角色的操作清单，如果该角色的操作清单中不包含该操作，且该角色的操作清单中也不包含字符串 `*`，那么不能执行该操作；</span></span><br><span class="line">    <span class="keyword">if</span> op <span class="keyword">not</span> <span class="keyword">in</span> r.op <span class="keyword">and</span> <span class="string">&#x27;*&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.op:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 2. 检查该角色的资源种类清单，如果该角色的资源种类清单中不包含该资源的种类，且该角色的资源种类清单中也不包含字符串 `*`，那么不能执行该操作；</span></span><br><span class="line">    <span class="keyword">if</span> source_type <span class="keyword">not</span> <span class="keyword">in</span> r.source_type <span class="keyword">and</span> <span class="string">&#x27;*&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.source_type:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 3. 检查该角色的资源名称清单，如果该角色的资源名称清单中不包含该资源的名称，且该角色的资源名称清单不是空数组，那么不能执行该操作；</span></span><br><span class="line">    <span class="keyword">if</span> source_name <span class="keyword">not</span> <span class="keyword">in</span> r.source_name <span class="keyword">and</span> r.source_name:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_user</span>(<span class="params">role_list, op_name, source_type, source_name</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 检测 role_list 中的角色能否执行操作 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">any</span>(check_op(r, op_name, source_type, source_name) <span class="keyword">for</span> r <span class="keyword">in</span> role_list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># Get input</span></span><br><span class="line">    n, m, q = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split())</span><br><span class="line">    <span class="comment"># n 个角色</span></span><br><span class="line">    roles = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        r = role(<span class="built_in">input</span>())</span><br><span class="line">        roles[r.name] = r</span><br><span class="line">    <span class="comment"># m 个角色关联, 用哈希表做 用户/用户组 -&gt; 角色 的映射</span></span><br><span class="line">    users = defaultdict(<span class="built_in">set</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        role_name, group = get_role_link(<span class="built_in">input</span>())</span><br><span class="line">        <span class="keyword">for</span> user <span class="keyword">in</span> group:</span><br><span class="line">            users[<span class="string">&quot;_&quot;</span>.join(user)].add(role_name)</span><br><span class="line">    <span class="comment"># q 个行为</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(q):</span><br><span class="line">        user_name, group, op_name, source_type, source_name = get_act(<span class="built_in">input</span>())</span><br><span class="line">        <span class="keyword">if</span> check_user(get_role_list(roles, users, user_name, group), op_name, source_type, source_name):</span><br><span class="line">            <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>太麻烦了懒得码其他语言的代码了</p>
</blockquote>
<hr>
<h2 id="光线追踪">光线追踪</h2>
<p>链接：<a target="_blank" rel="noopener" href="http://118.190.20.162/view.page?gpid=T145" class="uri">http://118.190.20.162/view.page?gpid=T145</a></p>
<ul>
<li>时间限制：2.0s</li>
<li>空间限制：512.0MB</li>
</ul>
<h3 id="问题描述-6">问题描述</h3>
<h4 id="问题描述-7">问题描述</h4>
<p>光线追踪是计算机图形学领域的一个重要算法，其原理是追踪一束从光源发出的光，经过不同的反射面，最终到达摄像机处的过程。</p>
<p>在这道问题中，你需要实现一段程序来处理一个简易的光线追踪模型。</p>
<p>在平面中有一些反射面，为方便起见，我们设这些反射面都是线段，与坐标轴成
<span class="math inline">45</span>
度角摆放，且两个端点的坐标均为<strong>整数</strong>。为进一步简化问题，我们假设所有的反射表面都是<strong>镜面反射</strong>。任何一束光线照射到反射面上（为避免讨论，假设反射面<strong>不含端点</strong>）时，都会改变方向为相应的镜面反射方向。注意，反射面的两侧都可以反射光线。</p>
<p>平面中还有一些激光光源，每个光源位于一个坐标为<strong>整数</strong>的点上，会向某个<strong>水平或竖直</strong>的方向发射一定强度的激光。</p>
<p>所有的反射面都不是完美的，每个反射面有一个折损系数 <span class="math inline"><em>a</em></span> ，当强度为 <span class="math inline"><em>I</em></span>
的光线照射上去时，反射光线的强度会变成 <span class="math inline"><em>a</em><em>I</em></span>
。为了便于处理，你可以认为所有反射面的材质均不算太好也不算太糟，因此所有的
<span class="math inline"><em>a</em></span> 均在 <span class="math inline">0.2 ∼ 0.8</span> 的范围内。</p>
<p>在一些超高速摄影问题中，有时甚至连光速都要考虑在内。在这个问题中，我们不妨假设激光在
<span class="math inline">1</span> 单位时间内恰好移动 <span class="math inline">1</span>
单位距离。然而，超高速摄影带来的往往是采样精度的损失，因此对于一束激光，最终采样到的光线强度都是<strong>向下取整</strong>后的数值。特别地，当一束激光的强度小于
<span class="math inline">1</span> 时，认为其已经完全耗散。</p>
<p>问题的最开始，平面上没有反射面也没有光源。接下来你需要处理若干个操作，每个操作形如：</p>
<p><code>1 x1 y1 x2 y2 a</code>：在平面上插入一个分别以 <span class="math inline">(<em>x</em>1, <em>y</em>1)</span> 和 <span class="math inline">(<em>x</em>2, <em>y</em>2)</span> 为端点，反射系数为
<span class="math inline"><em>a</em></span>
的反射面，保证反射面与坐标轴成 <span class="math inline">45</span>
度角摆放，且不与先前已经存在、且还没有被删除的反射面在非端点处相交；另外受到渲染效率的影响，问题中的所有反射面的总长度（可以理解为所有的
<span class="math inline">|<em>x</em>1 − <em>x</em>2|</span>
之和）不会太大。</p>
<p><code>2 k</code>：删除第 <span class="math inline"><em>k</em></span>
个操作插入的反射面，保证第 <span class="math inline"><em>k</em></span>
个操作发生在当前操作之前且为一个插入操作，且这个反射面还没有被删除；</p>
<p><code>3 x y d I t</code>：在 <span class="math inline">(<em>x</em>, <em>y</em>)</span>
位置放置一个光源，发射光线的方向为 <span class="math inline"><em>d</em></span> ，强度为 <span class="math inline"><em>I</em></span> ，求其所经 <span class="math inline"><em>t</em></span>
时刻后光线到达的坐标以及采样得到的光线强度。其中 <span class="math inline"><em>d</em></span> 的含义为：<span class="math inline"><em>d</em> = 0</span> 表示沿 <span class="math inline"><em>x</em></span> 坐标增加的方向，<span class="math inline"><em>d</em> = 1</span> 表示沿 <span class="math inline"><em>y</em></span> 坐标增加的方向，<span class="math inline"><em>d</em> = 2</span> 表示沿 <span class="math inline"><em>x</em></span> 坐标减小的方向，<span class="math inline"><em>d</em> = 3</span> 表示沿 <span class="math inline"><em>y</em></span>
坐标减小的方向。另外，保证光源不位于当前存在的某个反射面（不含端点）上。注意：如果
<span class="math inline"><em>t</em></span>
时刻后光线刚好到达某个反射面，则其强度取反射后的强度。</p>
<h4 id="输入格式-3">输入格式</h4>
<p>从标准输入读入数据。</p>
<p>第 <span class="math inline">1</span> 行，一个正整数 <span class="math inline"><em>m</em></span> 表示操作的总数量。</p>
<p>接下来 <span class="math inline"><em>m</em></span>
行，每行描述一个操作，格式如题目描述。</p>
<p>其中，除了所有的 <span class="math inline"><em>a</em></span> 和 <span class="math inline"><em>I</em></span> 以外的输入均为绝对值不超过 <span class="math inline">10<sup>9</sup></span> 的整数，其中 <span class="math inline"><em>k</em></span> 和 <span class="math inline"><em>t</em></span> 为正整数；<span class="math inline"><em>a</em></span> 和 <span class="math inline"><em>I</em></span> 均为小数点后不超过 <span class="math inline">6</span> 位的正实数，其中 <span class="math inline"><em>a</em></span> 在 <span class="math inline">0.2 ∼ 0.8</span>之间， <span class="math inline"><em>I</em> ≤ 10<sup>9</sup></span>。</p>
<h4 id="输出格式-3">输出格式</h4>
<p>输出到标准输出。</p>
<p>对于每个查询操作输出一行，<span class="math inline">3</span>
个整数，形如 <code>x y I</code> 表示激光最终到达的位置为 <span class="math inline">(<em>x</em>, <em>y</em>)</span>
，采样得到的光线强度为 <span class="math inline"><em>I</em></span>
。特别地，如果采样到的光线强度为 <span class="math inline">0</span>
（即光线已耗散），你也就无需关心最终到达的坐标，而只需要输出<code>0 0 0</code>即可。</p>
<p>题目数据保证，你可以在计算时直接使用 <span class="math inline">64</span>
位浮点数的运算和取整操作，而无需担心可能的精度误差问题。</p>
<h4 id="样例输入-2">样例输入</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">7</span><br><span class="line">1 0 4 2 2 0.4</span><br><span class="line">1 2 2 0 0 0.45</span><br><span class="line">3 -1 3 0 6 5</span><br><span class="line">3 1 5 3 2.4 5</span><br><span class="line">3 0 2 0 3 4</span><br><span class="line">2 1</span><br><span class="line">3 1 5 3 2.4 5</span><br></pre></td></tr></table></figure>
<h4 id="样例输出-2">样例输出</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 1 1</span><br><span class="line">0 0 0</span><br><span class="line">4 2 3</span><br><span class="line">0 1 1</span><br></pre></td></tr></table></figure>
<h4 id="数据范围">数据范围</h4>
<table>
<colgroup>
<col style="width: 14%">
<col style="width: 9%">
<col style="width: 76%">
</colgroup>
<thead>
<tr>
<th style="text-align: center;">测试点编号</th>
<th style="text-align: center;"><span class="math inline"><em>m</em>≤</span></th>
<th style="text-align: center;">特殊性质</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><span class="math inline">1 ∼ 3</span></td>
<td style="text-align: center;"><span class="math inline">1000</span></td>
<td style="text-align: center;">所有光线 <span class="math inline"><em>t</em> ≤ 1000</span> ，所有输入坐标的绝对值
<span class="math inline"> ≤ 1000</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="math inline">4 ∼ 7</span></td>
<td style="text-align: center;"><span class="math inline">1000</span></td>
<td style="text-align: center;">无</td>
</tr>
<tr>
<td style="text-align: center;"><span class="math inline">8 ∼ 10</span></td>
<td style="text-align: center;"><span class="math inline">10<sup>5</sup></span></td>
<td style="text-align: center;">所有光线的 <span class="math inline"><em>t</em> ≤ 10</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="math inline">11 ∼ 13</span></td>
<td style="text-align: center;"><span class="math inline">10<sup>5</sup></span></td>
<td style="text-align: center;">所有 <span class="math inline">1</span>
操作在所有 <span class="math inline">3</span> 操作之前，且无 <span class="math inline">2</span> 操作</td>
</tr>
<tr>
<td style="text-align: center;"><span class="math inline">14 ∼ 16</span></td>
<td style="text-align: center;"><span class="math inline">10<sup>5</sup></span></td>
<td style="text-align: center;">所有光线的 <span class="math inline"><em>I</em> = 1</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="math inline">17 ∼ 20</span></td>
<td style="text-align: center;"><span class="math inline">10<sup>5</sup></span></td>
<td style="text-align: center;">无</td>
</tr>
</tbody>
</table>
<p>对于 <span class="math inline">100%</span> 的数据，保证 <span class="math inline"><em>m</em> ≤ 10<sup>5</sup></span> ，所有反射面的
<span class="math inline">|<em>x</em>1 − <em>x</em>2|</span> 之和不超过
<span class="math inline">3 ∗ 10<sup>5</sup></span> 。</p>
<h3 id="问题解析-3">问题解析</h3>
<p>将样例示意图画了一下(没画最后一条光线)</p>
<figure>
<img data-src="CCF202206/gxzz.svg" alt="gxzz">
<figcaption aria-hidden="true">gxzz</figcaption>
</figure>
<p>其实比较有疑惑的只有第二个操作，<span class="math inline"><em>k</em></span>
到底表示的是什么，从示例中至少可以看出一定，<span class="math inline"><em>k</em></span> 等于 <span class="math inline">1</span> 时删掉的是第 <span class="math inline">1</span> 个操作的反射面，这里的操作编号是从 <span class="math inline">1</span> 开始的。</p>
<p>其实不难看出因为反射面都是 <span class="math inline">45</span>
度的所有光线一定是沿坐标轴方向的，也就是所反射面起到了一个改变光线前进方向的作用，这是有规律可循的。</p>
<p>所以难点在于</p>
<ul>
<li>如何判断光线在前进过程中会碰到哪些反射面，从数据范围 <span class="math inline">10<sup>5</sup></span>
可以看出，每次判断光线的运行时间复杂度必须控制在 <span class="math inline"><em>O</em>(log <em>n</em>)</span></li>
<li>如何确定反射点，这个其实不是特别难，可以通过数学方法进行计算</li>
</ul>
<p>其实不难看出反射面能反射光线的范围，就是一个 <strong>十</strong>
字型的区域，如下图所示</p>
<figure>
<img data-src="CCF202206/Solution2.svg" alt="Solution2">
<figcaption aria-hidden="true">Solution2</figcaption>
</figure>
<p>即对于某个方向来说，只要在一定区间内的光线都会碰到反射镜，但实际上我们的行为是反过来的，要通过判断光线是否在某个反射镜的区间内，这就要求我们建立一种可以进行区间查找的数据结构来存储反射镜</p>
<blockquote>
<p>好吧，想不到了，看了下网上的解析</p>
</blockquote>
<p>注意到题目中这么一句话：所有反射面的 <span class="math inline">|<em>x</em>1 − <em>x</em>2|</span> 之和不超过 <span class="math inline">3 ∗ 10<sup>5</sup></span>
，考虑将所有反射点存下来然后光线直接利用二分查找来查询。按照这个思路，可以将反射面分为
<code>"\", "/"</code>
两种，我们使用有序结构（例如红黑树）对反射点进行存储，此时插入和查找的复杂度都是
<span class="math inline"><em>O</em>(log <em>n</em>)</span>
（但如果频繁进行大镜面的插入和删除的话还是有 TLE 风险的）</p>
<hr>
<h4 id="运行结果-2">运行结果</h4>
<table>
<colgroup>
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 42%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr>
<th style="text-align: left;">提交编号</th>
<th style="text-align: left;">用户名</th>
<th style="text-align: left;">姓名</th>
<th style="text-align: left;">试题名称</th>
<th style="text-align: left;">提交时间</th>
<th style="text-align: left;">代码长度</th>
<th style="text-align: left;">编程语言</th>
<th style="text-align: left;">评测结果</th>
<th style="text-align: left;">得分</th>
<th style="text-align: left;">时间使用</th>
<th style="text-align: left;">空间使用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;"><a target="_blank" rel="noopener" href="http://118.190.20.162/view.page?gpid=T145">光线追踪</a></td>
<td style="text-align: left;">09-12 14:41</td>
<td style="text-align: left;">4.504KB</td>
<td style="text-align: left;">CPP14</td>
<td style="text-align: left;">错误</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">578ms</td>
<td style="text-align: left;">39.23MB</td>
</tr>
<tr>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;">*</td>
<td style="text-align: left;"><a target="_blank" rel="noopener" href="http://118.190.20.162/view.page?gpid=T145">光线追踪</a></td>
<td style="text-align: left;">09-12 12:40</td>
<td style="text-align: left;">4.619KB</td>
<td style="text-align: left;">PYTHON</td>
<td style="text-align: left;">运行错误</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">31ms</td>
<td style="text-align: left;">7.820MB</td>
</tr>
</tbody>
</table>
<h4 id="python">Python</h4>
<p>似乎 Python 环境不允许使用 <code>sortedcontainers</code>
所以会报错（推测，我本地Python 3.9 环境是可以通过样例的，但网上一些在线
Python3 环境会报运行错误），但是吧，手写红黑树实在是做不到🤦‍♀️</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sortedcontainers <span class="keyword">import</span> SortedList</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_mirror</span>(<span class="params">info: <span class="built_in">list</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 解析插入反射面 &quot;&quot;&quot;</span></span><br><span class="line">    info = <span class="built_in">iter</span>(info)</span><br><span class="line">    _ = <span class="built_in">next</span>(info)</span><br><span class="line">    x1, y1, x2, y2 = <span class="built_in">map</span>(<span class="built_in">int</span>, (<span class="built_in">next</span>(info) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)))</span><br><span class="line">    a = <span class="built_in">float</span>(<span class="built_in">next</span>(info))</span><br><span class="line">    <span class="keyword">return</span> (x1, y1), (x2, y2), a</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_remove</span>(<span class="params">info</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 解析移除反射面 &quot;&quot;&quot;</span></span><br><span class="line">    two, k = info</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(k)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_light</span>(<span class="params">info</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 解析添加光源 &quot;&quot;&quot;</span></span><br><span class="line">    info = <span class="built_in">iter</span>(info)</span><br><span class="line">    _  = <span class="built_in">next</span>(info)</span><br><span class="line">    x, y, d = <span class="built_in">map</span>(<span class="built_in">int</span>, (<span class="built_in">next</span>(info) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)))</span><br><span class="line">    i = <span class="built_in">float</span>(<span class="built_in">next</span>(info))</span><br><span class="line">    t = <span class="built_in">int</span>(<span class="built_in">next</span>(info))</span><br><span class="line">    <span class="keyword">return</span> (x, y), d, i, t</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_mirror</span>(<span class="params">step, points_x, points_y, points, mirrors, p1, p2, a</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 添加反射面 &quot;&quot;&quot;</span></span><br><span class="line">    mirrors[step] = (p1, p2, a)</span><br><span class="line">    x1, y1 = p1</span><br><span class="line">    x2, y2 = p2</span><br><span class="line">    mirror_type = (y2 - y1) // (x2 - x1)</span><br><span class="line">    <span class="keyword">if</span> x1 &gt; x2:</span><br><span class="line">        x1, x2 = x2, x1</span><br><span class="line">    <span class="keyword">if</span> (mirror_type == -<span class="number">1</span> <span class="keyword">and</span> y1 &lt; y2) <span class="keyword">or</span> (mirror_type == <span class="number">1</span> <span class="keyword">and</span> y1 &gt; y2):</span><br><span class="line">        y1, y2 = y2, y1</span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(<span class="built_in">range</span>(x1 + <span class="number">1</span>, x2), <span class="built_in">range</span>(y1 + mirror_type, y2, mirror_type)):</span><br><span class="line">        points_x[x].add(y)</span><br><span class="line">        points_y[y].add(x)</span><br><span class="line">        points[x][y] = (mirror_type, a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">del_mirror</span>(<span class="params">points_x, points_y, points, mirrors, k</span>):</span><br><span class="line">    p1, p2, a = mirrors[k - <span class="number">1</span>]</span><br><span class="line">    x1, y1 = p1</span><br><span class="line">    x2, y2 = p2</span><br><span class="line">    mirror_type = (y2 - y1) // (x2 - x1)</span><br><span class="line">    <span class="keyword">if</span> x1 &gt; x2:</span><br><span class="line">        x1, x2 = x2, x1</span><br><span class="line">    <span class="keyword">if</span> (mirror_type == -<span class="number">1</span> <span class="keyword">and</span> y1 &lt; y2) <span class="keyword">or</span> (mirror_type == <span class="number">1</span> <span class="keyword">and</span> y1 &gt; y2):</span><br><span class="line">        y1, y2 = y2, y1</span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(<span class="built_in">range</span>(x1 + <span class="number">1</span>, x2), <span class="built_in">range</span>(y1 + mirror_type, y2, mirror_type)):</span><br><span class="line">        points_x[x].remove(y)</span><br><span class="line">        points_y[y].remove(x)</span><br><span class="line">        <span class="keyword">del</span> points[x][y]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_x_right</span>(<span class="params">points_y: <span class="built_in">dict</span>, x: <span class="built_in">int</span>, y: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 沿着 x 增加方向前进的最近反射点 &quot;&quot;&quot;</span></span><br><span class="line">    cur: SortedList = points_y[y]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cur:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    t = cur.bisect_left(x)</span><br><span class="line">    <span class="keyword">if</span> t &gt;= <span class="built_in">len</span>(cur):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> cur[t]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_x_left</span>(<span class="params">points_y: <span class="built_in">dict</span>, x: <span class="built_in">int</span>, y: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 沿着 x 减小方向前进的最近反射点 &quot;&quot;&quot;</span></span><br><span class="line">    cur: SortedList = points_y[y]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cur:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    t = cur.bisect_left(x) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> t == -<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> cur[t]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_y_down</span>(<span class="params">points_x: <span class="built_in">dict</span>, x: <span class="built_in">int</span>, y: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 沿着 y 减小方向前进的最近反射点 &quot;&quot;&quot;</span></span><br><span class="line">    cur: SortedList = points_x[x]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cur:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    t = cur.bisect_left(y) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> t == -<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> cur[t]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_y_up</span>(<span class="params">points_x: <span class="built_in">dict</span>, x: <span class="built_in">int</span>, y: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 沿着 y 增加方向前进的最近反射点 &quot;&quot;&quot;</span></span><br><span class="line">    cur: SortedList = points_x[x]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cur:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    t = cur.bisect_left(y)</span><br><span class="line">    <span class="keyword">if</span> t &gt;= <span class="built_in">len</span>(cur):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> cur[t]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_light</span>(<span class="params">points_x, points_y, points, p, d, i, t</span>):</span><br><span class="line">    x, y = p</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 完全耗散</span></span><br><span class="line">        <span class="keyword">if</span> i &lt; <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> t &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(x, y, <span class="built_in">int</span>(i))</span><br><span class="line">        <span class="comment"># 根据方向查找最近的反射点</span></span><br><span class="line">        nx, ny = x, y</span><br><span class="line">        <span class="keyword">if</span> d == <span class="number">0</span>:</span><br><span class="line">            nx = search_x_right(points_y, x, y)</span><br><span class="line">        <span class="keyword">elif</span> d == <span class="number">1</span>:</span><br><span class="line">            ny = search_y_up(points_x, x, y)</span><br><span class="line">        <span class="keyword">elif</span> d == <span class="number">2</span>:</span><br><span class="line">            nx = search_x_left(points_y, x, y)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ny = search_y_down(points_x, x, y)</span><br><span class="line">        <span class="comment"># 不会遇到反射点，那么直接计算终点坐标即可</span></span><br><span class="line">        <span class="keyword">if</span> nx <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> ny <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="built_in">abs</span>(nx - x) &gt; t <span class="keyword">or</span> <span class="built_in">abs</span>(ny - y) &gt; t:</span><br><span class="line">            <span class="keyword">if</span> d == <span class="number">0</span>:</span><br><span class="line">                x += t</span><br><span class="line">            <span class="keyword">elif</span> d == <span class="number">1</span>:</span><br><span class="line">                y += t</span><br><span class="line">            <span class="keyword">elif</span> d == <span class="number">2</span>:</span><br><span class="line">                x -= t</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                y -= t</span><br><span class="line">            <span class="built_in">print</span>(x, y, <span class="built_in">int</span>(i))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        mirror_type, a = points[nx][ny]</span><br><span class="line">        t -= <span class="built_in">abs</span>(nx - x) + <span class="built_in">abs</span>(ny - y)</span><br><span class="line">        i *= a</span><br><span class="line">        x, y = nx, ny</span><br><span class="line">        <span class="keyword">if</span> mirror_type == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> d == <span class="number">0</span>:</span><br><span class="line">                d = <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> d == <span class="number">1</span>:</span><br><span class="line">                d = <span class="number">0</span></span><br><span class="line">            <span class="keyword">elif</span> d == <span class="number">2</span>:</span><br><span class="line">                d = <span class="number">3</span></span><br><span class="line">            <span class="keyword">elif</span> d == <span class="number">3</span>:</span><br><span class="line">                d = <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> d == <span class="number">0</span>:</span><br><span class="line">                d = <span class="number">3</span></span><br><span class="line">            <span class="keyword">elif</span> d == <span class="number">1</span>:</span><br><span class="line">                d = <span class="number">2</span></span><br><span class="line">            <span class="keyword">elif</span> d == <span class="number">2</span>:</span><br><span class="line">                d = <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> d == <span class="number">3</span>:</span><br><span class="line">                d = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    m = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">    <span class="comment"># 储存反射点的数据结构</span></span><br><span class="line">    points_x, points_y = defaultdict(SortedList), defaultdict(SortedList)</span><br><span class="line">    points = defaultdict(<span class="built_in">dict</span>)</span><br><span class="line">    mirrors = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">for</span> step <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        info = <span class="built_in">input</span>().split()</span><br><span class="line">        <span class="keyword">if</span> info[<span class="number">0</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            add_mirror(step, points_x, points_y, points, mirrors, *get_mirror(info))</span><br><span class="line">        <span class="keyword">elif</span> info[<span class="number">0</span>] == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            del_mirror(points_x, points_y, points, mirrors, get_remove(info))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            start_light(points_x, points_y, points, *get_light(info))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h4 id="c">C++</h4>
<p>只得了 15 分 姑且记录一下吧</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAX_STEP = <span class="number">100007</span>, MAX_VAL = <span class="number">2000000007</span>;</span><br><span class="line"><span class="type">int</span> m;</span><br><span class="line">unordered_map&lt;<span class="type">int</span>, set&lt;<span class="type">int</span>&gt;&gt; points_x, points_y;</span><br><span class="line">unordered_map&lt;<span class="type">int</span>, unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; points;</span><br><span class="line"><span class="type">int</span> mirror[MAX_STEP][<span class="number">5</span>];</span><br><span class="line"><span class="type">double</span> mirror_s[MAX_STEP];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add_mirror</span><span class="params">(<span class="type">int</span> step, <span class="type">int</span> x1, <span class="type">int</span> y1, <span class="type">int</span> x2, <span class="type">int</span> y2, <span class="type">double</span> a)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> dtype = (y2 - y1) / (x2 - x1);</span><br><span class="line">    mirror[step][<span class="number">0</span>] = x1;</span><br><span class="line">    mirror[step][<span class="number">1</span>] = y1;</span><br><span class="line">    mirror[step][<span class="number">2</span>] = x2;</span><br><span class="line">    mirror[step][<span class="number">3</span>] = y2;</span><br><span class="line">    mirror[step][<span class="number">4</span>] = dtype;</span><br><span class="line">    mirror_s[step] = a;</span><br><span class="line">    <span class="keyword">if</span> (x1 &gt; x2) <span class="built_in">swap</span>(x1, x2);</span><br><span class="line">    <span class="keyword">if</span> ((dtype == <span class="number">1</span> &amp;&amp; y1 &gt; y2) || (dtype == <span class="number">-1</span> &amp;&amp; y1 &lt; y2)) <span class="built_in">swap</span>(y1, y2);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x = x1 + <span class="number">1</span>, y = y1 + dtype; x &lt; x2; ++x, y += dtype) &#123;</span><br><span class="line">        points_x[x].<span class="built_in">emplace</span>(y);</span><br><span class="line">        points_y[y].<span class="built_in">emplace</span>(x);</span><br><span class="line">        points[x][y] = step;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">del_mirror</span><span class="params">(<span class="type">int</span> step)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x1 = mirror[step][<span class="number">0</span>], y1 = mirror[step][<span class="number">1</span>], x2 = mirror[step][<span class="number">2</span>], y2 = mirror[step][<span class="number">3</span>], dtype = mirror[step][<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">if</span> (x1 &gt; x2) <span class="built_in">swap</span>(x1, x2);</span><br><span class="line">    <span class="keyword">if</span> ((dtype == <span class="number">1</span> &amp;&amp; y1 &gt; y2) || (dtype == <span class="number">-1</span> &amp;&amp; y1 &lt; y2)) <span class="built_in">swap</span>(y1, y2);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x = x1 + <span class="number">1</span>, y = y1 + dtype; x &lt; x2; ++x, y += dtype) &#123;</span><br><span class="line">        points_x[x].<span class="built_in">erase</span>(y);</span><br><span class="line">        points_y[y].<span class="built_in">erase</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 沿着 x 增加方向前进的最近反射点</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">search_x_right</span><span class="params">(<span class="type">const</span> <span class="type">int</span> x, <span class="type">const</span> <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span>&amp; cur = points_y[y];</span><br><span class="line">    <span class="keyword">if</span> (cur.<span class="built_in">empty</span>()) <span class="keyword">return</span> MAX_VAL;</span><br><span class="line">    <span class="keyword">auto</span> nxt = cur.<span class="built_in">lower_bound</span>(x);</span><br><span class="line">    <span class="keyword">if</span> (nxt == cur.<span class="built_in">end</span>()) <span class="keyword">return</span> MAX_VAL;</span><br><span class="line">    <span class="keyword">return</span> *nxt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 沿着 x 减小方向前进的最近反射点</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">search_x_left</span><span class="params">(<span class="type">const</span> <span class="type">int</span> x, <span class="type">const</span> <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span>&amp; cur = points_y[y];</span><br><span class="line">    <span class="keyword">if</span> (cur.<span class="built_in">empty</span>()) <span class="keyword">return</span> MAX_VAL;</span><br><span class="line">    <span class="keyword">auto</span> nxt = cur.<span class="built_in">lower_bound</span>(x);</span><br><span class="line">    <span class="keyword">if</span> (nxt == cur.<span class="built_in">begin</span>()) <span class="keyword">return</span> MAX_VAL;</span><br><span class="line">    <span class="keyword">return</span> *(--nxt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 沿着 y 增加方向前进的最近反射点</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">search_y_up</span><span class="params">(<span class="type">const</span> <span class="type">int</span> x, <span class="type">const</span> <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span>&amp; cur = points_x[x];</span><br><span class="line">    <span class="keyword">if</span> (cur.<span class="built_in">empty</span>()) <span class="keyword">return</span> MAX_VAL;</span><br><span class="line">    <span class="keyword">auto</span> nxt = cur.<span class="built_in">lower_bound</span>(y);</span><br><span class="line">    <span class="keyword">if</span> (nxt == cur.<span class="built_in">end</span>()) <span class="keyword">return</span> MAX_VAL;</span><br><span class="line">    <span class="keyword">return</span> *nxt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 沿着 y 减小方向前进的最近反射点</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">search_y_down</span><span class="params">(<span class="type">const</span> <span class="type">int</span> x, <span class="type">const</span> <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span>&amp; cur = points_x[x];</span><br><span class="line">    <span class="keyword">if</span> (cur.<span class="built_in">empty</span>()) <span class="keyword">return</span> MAX_VAL;</span><br><span class="line">    <span class="keyword">auto</span> nxt = cur.<span class="built_in">lower_bound</span>(y);</span><br><span class="line">    <span class="keyword">if</span> (nxt == cur.<span class="built_in">begin</span>()) <span class="keyword">return</span> MAX_VAL;</span><br><span class="line">    <span class="keyword">return</span> *(--nxt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">start_light</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> d, <span class="type">double</span> i, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// printf(&quot;Before: %d %d %d %lf %d\n&quot;, x, y, d, i, t);</span></span><br><span class="line">        <span class="comment">// 完全耗散</span></span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">1.</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;0 0 0\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (t &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>, x, y, (<span class="type">int</span>)i);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据方向查找最近的反射点</span></span><br><span class="line">        <span class="type">int</span> nx = x, ny = y;</span><br><span class="line">        <span class="keyword">if</span> (d == <span class="number">0</span>)</span><br><span class="line">            nx = <span class="built_in">search_x_right</span>(x, y);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (d == <span class="number">1</span>)</span><br><span class="line">            ny = <span class="built_in">search_y_up</span>(x, y);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (d == <span class="number">2</span>)</span><br><span class="line">            nx = <span class="built_in">search_x_left</span>(x, y);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            ny = <span class="built_in">search_y_down</span>(x, y);</span><br><span class="line">        <span class="comment">// printf(&quot;mid: %d %d\n&quot;, nx, ny);</span></span><br><span class="line">        <span class="comment">// 不会遇到反射点，那么直接计算终点坐标即可</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">abs</span>(nx - x) &gt; t || <span class="built_in">abs</span>(ny - y) &gt; t) &#123;</span><br><span class="line">            <span class="keyword">if</span> (d == <span class="number">0</span>)</span><br><span class="line">                x += t;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (d == <span class="number">1</span>)</span><br><span class="line">                y += t;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (d == <span class="number">2</span>)</span><br><span class="line">                x -= t;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                y -= t;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>, x, y, (<span class="type">int</span>)i);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> step = points[nx][ny];</span><br><span class="line">        <span class="type">int</span> dtype = mirror[step][<span class="number">4</span>];</span><br><span class="line">        <span class="type">double</span> a = mirror_s[step];</span><br><span class="line">        t -= <span class="built_in">abs</span>(nx - x) + <span class="built_in">abs</span>(ny - y);</span><br><span class="line">        i *= a;</span><br><span class="line">        x = nx;</span><br><span class="line">        y = ny;</span><br><span class="line">        <span class="keyword">if</span> (dtype == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (d == <span class="number">0</span>)</span><br><span class="line">                d = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (d == <span class="number">1</span>)</span><br><span class="line">                d = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (d == <span class="number">2</span>)</span><br><span class="line">                d = <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (d == <span class="number">3</span>)</span><br><span class="line">                d = <span class="number">2</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (d == <span class="number">0</span>)</span><br><span class="line">                d = <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (d == <span class="number">1</span>)</span><br><span class="line">                d = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (d == <span class="number">2</span>)</span><br><span class="line">                d = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (d == <span class="number">3</span>)</span><br><span class="line">                d = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// printf(&quot;After: %d %d %d %lf %d\n&quot;, x, y, d, i, t);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">    <span class="type">int</span> k, x1, y1, x2, y2, x, y, d, t;</span><br><span class="line">    <span class="type">double</span> a, i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> step = <span class="number">1</span>; step &lt;= m; ++step) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;k);</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d%lf&quot;</span>, &amp;x1, &amp;y1, &amp;x2, &amp;y2, &amp;a);</span><br><span class="line">            <span class="built_in">add_mirror</span>(step, x1, y1, x2, y2, a);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (k == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;k);</span><br><span class="line">            <span class="built_in">del_mirror</span>(k);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%lf%d&quot;</span>, &amp;x, &amp;y, &amp;d, &amp;i, &amp;t);</span><br><span class="line">            <span class="built_in">start_light</span>(x, y, d, i, t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>MeteorDream
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://meteordream.github.io/CSP/2022-09/CSP202206.html" title="CSP202206">https://meteordream.github.io/CSP/2022-09/CSP202206.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <div>
        
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">--- ♥ end ♥ ---</div>
    
</div>
        
      </div>
        

  <div class="followme">
    <p>欢迎关注我呀~</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat_channel.jpg">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://github.com/MeteorDream">
            <span class="icon">
              <i class="fab fa-github"></i>
            </span>

            <span class="label">GitHub</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://leetcode-cn.com/u/meteordream/">
            <span class="icon">
              <i class="fab fa-envira"></i>
            </span>

            <span class="label">LeetCode</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/CSP/" rel="tag"><i class="fa fa-tag"></i> CSP</a>
              <a href="/tags/Algorithm/" rel="tag"><i class="fa fa-tag"></i> 算法</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/LeetCode/2022-09/1598_%E6%96%87%E4%BB%B6%E5%A4%B9%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97%E6%90%9C%E9%9B%86%E5%99%A8(%E7%AE%80%E5%8D%95).html" rel="prev" title="『LeetCode』1598 文件夹操作日志搜集器">
      <i class="fa fa-chevron-left"></i> 『LeetCode』1598 文件夹操作日志搜集器
    </a></div>
      <div class="post-nav-item">
    <a href="/CSP/2022-09/CSP202203.html" rel="next" title="CSP202203">
      CSP202203 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          梦境概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BD%92%E4%B8%80%E5%8C%96%E5%A4%84%E7%90%86"><span class="nav-number">2.</span> <span class="nav-text">归一化处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="nav-number">2.1.</span> <span class="nav-text">问题描述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E8%83%8C%E6%99%AF"><span class="nav-number">2.1.1.</span> <span class="nav-text">题目背景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0-1"><span class="nav-number">2.1.2.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E6%A0%BC%E5%BC%8F"><span class="nav-number">2.1.3.</span> <span class="nav-text">输入格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F"><span class="nav-number">2.1.4.</span> <span class="nav-text">输出格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B%E8%BE%93%E5%85%A5"><span class="nav-number">2.1.5.</span> <span class="nav-text">样例输入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B%E8%BE%93%E5%87%BA"><span class="nav-number">2.1.6.</span> <span class="nav-text">样例输出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B%E8%A7%A3%E9%87%8A"><span class="nav-number">2.1.7.</span> <span class="nav-text">样例解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%90%E4%BB%BB%E5%8A%A1"><span class="nav-number">2.1.8.</span> <span class="nav-text">子任务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%84%E5%88%86%E6%96%B9%E5%BC%8F"><span class="nav-number">2.1.9.</span> <span class="nav-text">评分方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E7%A4%BA"><span class="nav-number">2.1.10.</span> <span class="nav-text">提示</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E8%A7%A3%E6%9E%90"><span class="nav-number">2.2.</span> <span class="nav-text">问题解析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#python%E4%BB%A3%E7%A0%81"><span class="nav-number">2.2.1.</span> <span class="nav-text">Python代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#c%E4%BB%A3%E7%A0%81"><span class="nav-number">2.2.2.</span> <span class="nav-text">C++代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BB%E5%AE%9D%E5%A4%A7%E5%86%92%E9%99%A9"><span class="nav-number">3.</span> <span class="nav-text">寻宝！大冒险！</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0-2"><span class="nav-number">3.1.</span> <span class="nav-text">问题描述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E8%83%8C%E6%99%AF-1"><span class="nav-number">3.1.1.</span> <span class="nav-text">题目背景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0-3"><span class="nav-number">3.1.2.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E6%A0%BC%E5%BC%8F-1"><span class="nav-number">3.1.3.</span> <span class="nav-text">输入格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F-1"><span class="nav-number">3.1.4.</span> <span class="nav-text">输出格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B1%E8%BE%93%E5%85%A5"><span class="nav-number">3.1.5.</span> <span class="nav-text">样例1输入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B1%E8%BE%93%E5%87%BA"><span class="nav-number">3.1.6.</span> <span class="nav-text">样例1输出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B1%E8%A7%A3%E9%87%8A"><span class="nav-number">3.1.7.</span> <span class="nav-text">样例1解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B2%E8%BE%93%E5%85%A5"><span class="nav-number">3.1.8.</span> <span class="nav-text">样例2输入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B2%E8%BE%93%E5%87%BA"><span class="nav-number">3.1.9.</span> <span class="nav-text">样例2输出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B2%E8%A7%A3%E9%87%8A"><span class="nav-number">3.1.10.</span> <span class="nav-text">样例2解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%90%E4%BB%BB%E5%8A%A1-1"><span class="nav-number">3.1.11.</span> <span class="nav-text">子任务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E7%A4%BA-1"><span class="nav-number">3.1.12.</span> <span class="nav-text">提示</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E8%A7%A3%E6%9E%90-1"><span class="nav-number">3.2.</span> <span class="nav-text">问题解析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C"><span class="nav-number">3.2.1.</span> <span class="nav-text">运行结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#python%E4%BB%A3%E7%A0%81-1"><span class="nav-number">3.2.2.</span> <span class="nav-text">Python代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#c%E4%BB%A3%E7%A0%81-1"><span class="nav-number">3.2.3.</span> <span class="nav-text">C++代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%92%E8%89%B2%E6%8E%88%E6%9D%83"><span class="nav-number">4.</span> <span class="nav-text">角色授权</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0-4"><span class="nav-number">4.1.</span> <span class="nav-text">问题描述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E8%83%8C%E6%99%AF-2"><span class="nav-number">4.1.1.</span> <span class="nav-text">题目背景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0-5"><span class="nav-number">4.1.2.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E6%A0%BC%E5%BC%8F-2"><span class="nav-number">4.1.3.</span> <span class="nav-text">输入格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F-2"><span class="nav-number">4.1.4.</span> <span class="nav-text">输出格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B%E8%BE%93%E5%85%A5-1"><span class="nav-number">4.1.5.</span> <span class="nav-text">样例输入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B%E8%BE%93%E5%87%BA-1"><span class="nav-number">4.1.6.</span> <span class="nav-text">样例输出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B%E8%A7%A3%E9%87%8A-1"><span class="nav-number">4.1.7.</span> <span class="nav-text">样例解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%90%E4%BB%BB%E5%8A%A1-2"><span class="nav-number">4.1.8.</span> <span class="nav-text">子任务</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E8%A7%A3%E6%9E%90-2"><span class="nav-number">4.2.</span> <span class="nav-text">问题解析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C-1"><span class="nav-number">4.2.1.</span> <span class="nav-text">运行结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#python%E4%BB%A3%E7%A0%81-2"><span class="nav-number">4.2.2.</span> <span class="nav-text">Python代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA"><span class="nav-number">5.</span> <span class="nav-text">光线追踪</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0-6"><span class="nav-number">5.1.</span> <span class="nav-text">问题描述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0-7"><span class="nav-number">5.1.1.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E6%A0%BC%E5%BC%8F-3"><span class="nav-number">5.1.2.</span> <span class="nav-text">输入格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F-3"><span class="nav-number">5.1.3.</span> <span class="nav-text">输出格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B%E8%BE%93%E5%85%A5-2"><span class="nav-number">5.1.4.</span> <span class="nav-text">样例输入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B7%E4%BE%8B%E8%BE%93%E5%87%BA-2"><span class="nav-number">5.1.5.</span> <span class="nav-text">样例输出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%8C%83%E5%9B%B4"><span class="nav-number">5.1.6.</span> <span class="nav-text">数据范围</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E8%A7%A3%E6%9E%90-3"><span class="nav-number">5.2.</span> <span class="nav-text">问题解析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C-2"><span class="nav-number">5.2.1.</span> <span class="nav-text">运行结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#python"><span class="nav-number">5.2.2.</span> <span class="nav-text">Python</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#c"><span class="nav-number">5.2.3.</span> <span class="nav-text">C++</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="小鲸鱼"
      src="/images/shizuku.png">
  <p class="site-author-name" itemprop="name">小鲸鱼</p>
  <div class="site-description" itemprop="description">小鲸鱼只有七秒钟的记忆</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">235</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">96</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/MeteorDream" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;MeteorDream" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hy1368068258@163.com" title="E-Mail → mailto:hy1368068258@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://meteordream.github.io/" title="感谢 → https:&#x2F;&#x2F;meteordream.github.io"><i class="fa fa-kiss-wink-heart fa-fw"></i>感谢</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://leetcode.cn/u/meteordream/" title="LeetCode → https:&#x2F;&#x2F;leetcode.cn&#x2F;u&#x2F;meteordream&#x2F;" rel="noopener" target="_blank"><i class="fab fa-envira fa-fw"></i>LeetCode</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021-04 – 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小鲸鱼</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1.3m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">19:46</span>
</div><script color="0,0,255" opacity="0.6" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js">
</script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.bootcdn.net/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'n9rYOoqPd5IsOQpuSgyY7ci3-gzGzoHsz',
      appKey     : '0BuiiqBGewzAwktQnJ9vXQMB',
      placeholder: "想和小鲸鱼说些什么吗~ (评论区支持MarkDown语法哦~)",
      avatar     : 'mp',
      meta       : guest,
      pageSize   : '20' || 10,
      visitor    : false,
      lang       : 'zh-CN' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":30,"vOffset":-30},"mobile":{"show":true,"opacity":0.5,"scale":0.3},"react":{"opacity":0.7,"opacityOnHover":0.2},"log":false});</script></body>

  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="/js/src/clicklove.js"></script>

</html>
